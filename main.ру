import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

np.random.seed(42)

def make_data(n=600):
    solar_flux = np.random.normal(150, 50, n)
    magnetic = np.random.normal(5, 2, n)
    wind = np.random.normal(400, 100, n)

    storm = ((solar_flux > 180) & (magnetic > 6) & (wind > 450)).astype(int)

    return pd.DataFrame({
        "solar_flux": solar_flux,
        "magnetic_index": magnetic,
        "solar_wind_speed": wind,
        "storm": storm
    })

def train():
    df = make_data()
    X = df[["solar_flux", "magnetic_index", "solar_wind_speed"]]
    y = df["storm"]

    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    model = RandomForestClassifier(n_estimators=150, random_state=42)
    model.fit(X_train, y_train)

    acc = model.score(X_test, y_test)
    print(f"Model accuracy: {acc:.2f}")
    return model

def ask_number(text):
    while True:
        try:
            return float(input(text).strip().replace(",", "."))
        except:
            print("Введите число, например 180 или 180.5")

def main():
    print("SolarShield AI — console MVP\n")
    model = train()

    while True:
        f = ask_number("Solar flux: ")
        m = ask_number("Magnetic index: ")
        w = ask_number("Solar wind speed: ")

        sample = pd.DataFrame({
            "solar_flux": [f],
            "magnetic_index": [m],
            "solar_wind_speed": [w]
        })

        risk = model.predict_proba(sample)[0][1] * 100
        print(f"\nRisk of solar storm: {risk:.1f}%")

        if risk >= 60:
            print("⚠ Warning: high risk!")
        else:
            print("✅ Low risk.")

        again = input("\nЕще раз? (y/n): ").lower().strip()
        if again not in ("y", "yes", "д", "да"):
            break
        print()

if __name__ == "__main__":
    main()
